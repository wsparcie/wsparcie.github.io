// Enhanced translations.js with theme switcher-like functionality
const translations = {
  en: {
    // Navigation
    HOME: 'HOME',
    ABOUT_ME: 'ABOUT_ME',
    PROJECTS: 'PROJECTS',
    CONTACT: 'CONTACT',
    BLOG: 'BLOG',

    // Main page sections
    CURRENT_GOAL: '[CURRENT_GOAL]',
    EDUCATION: '[EDUCATION]',
    APTITUDES: '[APTITUDES]',
    SKILLS: '[SKILLS]',
    ACHIEVEMENTS: '[ACHIEVEMENTS]',

    // Description text
    DESCRIPTION: `My goal is to gain experience in the IT field, particularly in cybersecurity. This would provide an opportunity to utilize the practical and theoretical skills I have acquired so far, both in my engineering studies and in self-development. I would like to do an internship at your company with the possibility of starting immediately.

I'm a cybersecurity student with a love for creating practical solutions and exploring different aspects of programming. From cybersecurity to web development, from data analysis to procedural 3D modeling - I enjoy diving into diverse technological challenges.`,

    // Skills categories
    'PROGRAMMING & SOFTWARE DEVELOPMENT':
      '▶ PROGRAMMING & SOFTWARE DEVELOPMENT',
    'DATA ANALYSIS & SCIENCE': '▶ DATA ANALYSIS & SCIENCE',
    'WEB TECHNOLOGIES & FRONTEND': '▶ WEB TECHNOLOGIES & FRONTEND',
    'DATABASE & BACKEND TECHNOLOGIES': '▶ DATABASE & BACKEND TECHNOLOGIES',
    'SYSTEM & NETWORK ADMINISTRATION': '▶ SYSTEM & NETWORK ADMINISTRATION',
    'CYBERSECURITY & PENETRATION TESTING':
      '▶ CYBERSECURITY & PENETRATION TESTING',

    // Technologies
    Python: 'Python',
    'C++, C#': 'C++, C#',
    JavaScript: 'JavaScript',
    'Bash, PowerShell': 'Bash, PowerShell',
    Docker: 'Docker',
    'Version Control': 'Version Control',

    'Data Processing': 'Data Processing',
    'Data Visualization': 'Data Visualization',
    'Web Scraping': 'Web Scraping',
    'OCR & Image Processing': 'OCR & Image Processing',

    'Django/Flask': 'Django/Flask',
    'HTML/CSS/JavaScript': 'HTML/CSS/JavaScript',
    'RESTful APIs': 'RESTful APIs',
    'GUI Development': 'GUI Development',

    'Database Design': 'Database Design',
    'Authentication Systems': 'Authentication Systems',

    'Operating Systems': 'Operating Systems',
    Networks: 'Networks',

    'Web Application Security': 'Web Application Security',
    'Network Protocol Analysis': 'Network Protocol Analysis',
    'Cryptographic Analysis': 'Cryptographic Analysis',

    // Descriptions
    Python_description:
      '— automation scripts, web/GUI/CLI applications, data analysis',
    'C++, C#_description': '— desktop applications, game development in Unity',
    JavaScript_description:
      '— web development, Discord bots, frontend scripting',
    'Bash, PowerShell_description': '— system administration, tasks automation',
    Docker_description:
      '— regular usage of containerization, monitoring with Grafana Pyroscope',
    'Version Control_description':
      '— systematic work with Git and GitHub workflows',

    'Data Processing_description':
      '— PANDAS NUMPY data processing & statistical analysis',
    'Data Visualization_description': '— MATPLOTLIB PLOTLY charts & reports',
    'Web Scraping_description': '— SELENIUM BEAUTIFULSOUP data extraction',
    'OCR & Image Processing_description':
      '— TESSERACT PILLOW text recognition and graphic editing',

    'Django/Flask_description':
      '— full-stack web applications, authentication systems',
    'HTML/CSS/JavaScript_description':
      '— responsive modern web design, Bootstrap framework',
    'RESTful APIs_description': '— web services creation',
    'GUI Development_description': '— PYSIDE6/QT6 TKINTER desktop applications',

    'Database Design_description': '— entity relationships, SQL management',
    'Authentication Systems_description':
      '— data management, session handling, BCrypt encryption',

    'Operating Systems_description':
      '— Windows & Linux administration, security & filesystem management',
    Networks_description:
      '— LAN design & implementation, router/switch configuration, VLAN management',

    'Web Application Security_description':
      '— BURP SUITE METASPLOIT penetration testing',
    'Network Protocol Analysis_description': '— WIRESHARK SOCAT SCAPY HYDRA',
    'Cryptographic Analysis_description':
      '— encryption algorithms, HASHCAT JOHN THE RIPPER passwords cracking',

    // Aptitudes
    'FAST LEARNER': 'FAST LEARNER',
    'DATA HUNTER': 'DATA HUNTER',
    ORGANIZED: 'ORGANIZED',
    PRECISE: 'PRECISE',
    RELIABLE: 'RELIABLE',
    RESPONSIBLE: 'RESPONSIBLE',
    'PRESSURE RESISTANT': 'PRESSURE RESISTANT',
    'DEADLINE KEEPER': 'DEADLINE KEEPER',

    // About page
    PROFILE: '[PROFILE]',
    PERSONAL_INFO: '[PERSONAL_INFO]',
    MOTIVATION: '▶ MOTIVATION',
    ROADMAP: '[ROADMAP]',
    'CURRENT FOCUS': '▶ CURRENT FOCUS',

    BACKGROUND_TEXT1: `I'm a passionate student with a love for creating practical solutions and exploring different aspects of programming. Currently pursuing a degree in Cybersecurity at Wroclaw University of Science and Technology. My passion for technology and security drives me to continuously expand my knowledge through hands-on projects and self-directed learning.`,
    BACKGROUND_TEXT2: `I thrive in challenging environments where I can apply both theoretical knowledge and practical skills to solve complex problems. My goal is to contribute to the cybersecurity field while continuously growing as a programmer.`,

    Security: 'Security',
    Automation: 'Automation',
    'Data Science': 'Data Science',
    'Full-Stack Development': 'Full-Stack Development',

    Security_description:
      '— staying updated with latest threats and defense mechanisms',
    Automation_description:
      '— creating interactive experiences and procedural content',
    'Data Science_description': '— participating in community-driven projects',
    'Full-Stack Development_description':
      '— exploring penetration testing and vulnerability assessment',

    // Projects page
    'PROJECT: SOCIAL IMPACT': '[PROJECT: SOCIAL IMPACT]',
    'STATUS: COMPLETED & PUBLISHED': 'STATUS: COMPLETED & PUBLISHED',
    CONTRIBUTION: 'CONTRIBUTION',
    PLAY_GAME: '[PLAY GAME]',
    'PROJECT: EDUCATIONAL': '[PROJECT: EDUCATIONAL]',
    'PROJECT: SOCIAL IMPACT_description': `> Ecological computer game project
              Garbage Can, organized by
              Zwolnieni z Teorii foundation`,
    GITHUB_REPOSITORIES: '[GITHUB_REPOSITORIES]',
    'GITHUB FEED': '▶ GITHUB FEED',
    LOADING: 'LOADING',
    PROJECTS: '[PROJECTS]',
    ACHIEVEMENTS: '[ACHIEVEMENTS]',
    'PROJECT_EDUCATIONAL': '[PROJECT: EDUCATIONAL]',
    'PROJECT_EDUCATIONAL_description': `Individual Educational Development Plan implementation
          Mazowieckie Scholarship Program for Exceptionally Talented Students
    [ORGANIZER: Mazowieckie Voivodeship Marshal's Office]`,

    'PROJECT: EDUCATIONAL_description': `Individual Educational Development Plan implementation
          Mazowieckie Scholarship Program for Exceptionally Talented Students
    [ORGANIZER: Mazowieckie Voivodeship Marshal's Office]`,

    // Contact page
    CONTACT_CHANNELS: '[CONTACT_CHANNELS]',
    ENCRYPTED_MAIL: 'ENCRYPTED_MAIL',
    SECURE_MATRIX: 'SECURE_MATRIX',
    SOCIAL_NETWORKS: 'SOCIAL_NETWORKS',
    DIRECT_TRANSMISSION: '[DIRECT_TRANSMISSION]',
    IDENTITY_STRING: 'IDENTITY_STRING:',
    ENTER_YOUR_NAME: 'ENTER_YOUR_NAME',
    CONTACT_NODE: 'CONTACT_NODE:',
    YOUR_ENCRYPTED_MAIL: 'YOUR_ENCRYPTED_MAIL',
    TRANSMISSION_TYPE: 'TRANSMISSION_TYPE:',
    JOB_OFFER: 'JOB_OFFER',
    COLLABORATION: 'COLLABORATION',
    TECH_QUESTION: 'TECH_QUESTION',
    OTHER_QUERY: 'OTHER_QUERY',
    'MESSAGE_PAYLOAD:': 'MESSAGE_PAYLOAD:',
    ENTER_YOUR_MESSAGE_HERE: 'ENTER_YOUR_MESSAGE_HERE',
    INITIATE_TRANSMISSION: 'INITIATE_TRANSMISSION',
    PURGE_BUFFER: 'PURGE_BUFFER',
    'TRANSMISSION_SUCCESSFUL: Message received and encrypted':
      'TRANSMISSION_SUCCESSFUL: Message received and encrypted',
    TRANSMISSION_FAILED: 'TRANSMISSION_FAILED',

    // Education details
    'Wroclaw University of Science and Technology':
      'Wroclaw University of Science and Technology',
    'INITIALIZED: 2024': 'INITIALIZED: 2024',
    'FACULTY: Information and Communication Technology':
      'FACULTY: Information and Communication Technology',
    'SPECIALIZATION: Cybersceurity': 'SPECIALIZATION: Cybersecurity',
    'University of Warsaw': 'University of Warsaw',
    'INITIALIZED: 2023 - 2024': 'INITIALIZED: 2023 - 2024',
    'FACULTY: Mathematics, Informatics and Mechanics':
      'FACULTY: Mathematics, Informatics and Mechanics',
    'SPECIALIZATION: Computer Science': 'SPECIALIZATION: Computer Science',
    LANGUAGES: 'LANGUAGES',
    CERTIFICATES: 'CERTIFICATES',

    // Footer
    '© 2024 KSZ://CYBER_SITE. All rights reserved.':
      '© 2024 KSZ://CYBER_SITE. All rights reserved.',
  },
  pl: {
    // Navigation
    HOME: 'STRONA_GŁÓWNA',
    ABOUT_ME: 'O_MNIE',
    PROJECTS: 'PROJEKTY',
    CONTACT: 'KONTAKT',
    BLOG: 'BLOG',

    // Main page sections
    CURRENT_GOAL: '[OBECNY_CEL]',
    EDUCATION: '[EDUKACJA]',
    APTITUDES: '[UMIEJĘTNOŚCI]',
    SKILLS: '[TECHNOLOGIE]',
    ACHIEVEMENTS: '[OSIĄGNIĘCIA]',

    // Description text
    DESCRIPTION: `Moim celem jest zdobycie doświadczenia w branży IT, a w szczególności w dziedzinie cyberbezpieczeństwa. Dałoby mi to możliwość wykorzystania praktycznych i teoretycznych umiejętności, które zdobyłem dotychczas zarówno podczas studiów inżynierskich, jak i w ramach samokształcenia. Chciałbym odbyć staż w Państwa firmie z możliwością natychmiastowego rozpoczęcia pracy.

Jestem pełnym pasji studentem cyberbezpieczeństwa, który uwielbia tworzyć praktyczne rozwiązania i zgłębiać różne aspekty programowania. Od cyberbezpieczeństwa po tworzenie stron internetowych, od analizy danych po proceduralne modelowanie 3D — lubię mierzyć się z różnorodnymi wyzwaniami technologicznymi.`,

    // Skills categories
    'PROGRAMMING & SOFTWARE DEVELOPMENT':
      '▶ PROGRAMOWANIE I TWORZENIE OPROGRAMOWANIA',
    'DATA ANALYSIS & SCIENCE': '▶ ANALIZA DANYCH I DATA SCIENCE',
    'WEB TECHNOLOGIES & FRONTEND': '▶ TECHNOLOGIE WEBOWE I FRONTEND',
    'DATABASE & BACKEND TECHNOLOGIES': '▶ BAZY DANYCH I BACKEND',
    'SYSTEM & NETWORK ADMINISTRATION': '▶ ADMINISTRACJA SYSTEMÓW I SIECI',
    'CYBERSECURITY & PENETRATION TESTING':
      '▶ CYBERBEZPIECZEŃSTWO I TESTY PENETRACYJNE',

    // Technologies
    Python: 'Python',
    'C++, C#': 'C++, C#',
    JavaScript: 'JavaScript',
    'Bash, PowerShell': 'Bash, PowerShell',
    Docker: 'Docker',
    'Version Control': 'Kontrola wersji',

    'Data Processing': 'Przetwarzanie danych',
    'Data Visualization': 'Wizualizacja danych',
    'Web Scraping': 'Web scraping',
    'OCR & Image Processing': 'OCR i przetwarzanie obrazów',

    'Django/Flask': 'Django/Flask',
    'HTML/CSS/JavaScript': 'HTML/CSS/JavaScript',
    'RESTful APIs': 'RESTful APIs',
    'GUI Development': 'Tworzenie GUI',

    'Database Design': 'Bazy danych',
    'Authentication Systems': 'Systemy uwierzytelniania',

    'Operating Systems': 'Systemy operacyjne',
    Networks: 'Sieci',

    'Web Application Security': 'Bezpieczeństwo aplikacji webowych',
    'Network Protocol Analysis': 'Analiza protokołów i ruchu sieciowego',
    'Cryptographic Analysis': 'Analiza kryptograficzna',

    // Descriptions
    Python_description:
      '— skrypty automatyzacyjne, aplikacje webowe/GUI/CLI, analiza danych',
    'C++, C#_description': '— aplikacje desktopowe, rozwój gier w Unity',
    JavaScript_description:
      '— strony internetowe, boty na platformę Discord, skrypty frontendowe',
    'Bash, PowerShell_description':
      '— administracja systemami, skrypty automatyzacyjne',
    Docker_description:
      '— regularne korzystanie z konteneryzacji, monitoring z użyciem Grafana Pyroscope',
    'Version Control_description': '— systematyczna praca z Gitem i GitHubem',

    'Data Processing_description':
      '— Pandas, NumPy do obróbki danych i analizy statystycznej',
    'Data Visualization_description':
      '— Matplotlib, Plotly do wykresów i raportów',
    'Web Scraping_description':
      '— Selenium, BeautifulSoup do ekstrakcji danych',
    'OCR & Image Processing_description':
      '— Tesseract, Pillow do rozpoznawania tekstu i edycji grafiki',

    'Django/Flask_description':
      '— aplikacje webowe full-stack, systemy uwierzytelniania',
    'HTML/CSS/JavaScript_description':
      '— responsywny i współczesny web design, Bootstrap framework',
    'RESTful APIs_description': '— tworzenie usług webowych',
    'GUI Development_description':
      '— PySide6/Qt6, Tkinter do aplikacji desktopowych',

    'Database Design_description':
      '— relacje między encjami, tworzenie i zarządzanie w języku SQL',
    'Authentication Systems_description':
      '— zarządzanie danymi, obsługa sesji, szyfrowanie z bcrypt',

    'Operating Systems_description':
      '— administracja Windows i Linux, zarządzanie bezpieczeństwem i systemami plików',
    Networks_description:
      '— projektowanie i tworzenie sieci lokalnych, konfiguracja routerów i przełączników',

    'Web Application Security_description':
      '— Burp Suite, Metasploit framework do testów penetracyjnych',
    'Network Protocol Analysis_description': '— Wireshark, Socat, Scapy, Hydra',
    'Cryptographic Analysis_description':
      '— algorytmy szyfrowania, Hashcat, John The Ripper do łamania haseł',

    // Aptitudes
    'FAST LEARNER': 'SZYBKO SIĘ UCZĘ',
    'DATA HUNTER': 'ŁOWCA DANYCH',
    ORGANIZED: 'ZORGANIZOWANY',
    PRECISE: 'PRECYZYJNY',
    RELIABLE: 'NIEZAWODNY',
    RESPONSIBLE: 'ODPOWIEDZIALNY',
    'PRESSURE RESISTANT': 'ODPORNY NA STRES',
    'DEADLINE KEEPER': 'DOTRZYMUJĘ TERMINÓW',

    // About page
    PROFILE: '[PROFIL]',
    PERSONAL_INFO: '[INFORMACJE_OSOBISTE]',
    MOTIVATION: '▶ MOTYWACJA',
    ROADMAP: '[PLAN_ROZWOJU]',
    'CURRENT FOCUS': '▶ OBECNY FOKUS',

    BACKGROUND_TEXT1:
      'Jestem pasjonatem studentem z miłością do tworzenia praktycznych rozwiązań i eksplorowania różnych aspektów programowania. Obecnie studiuję Cyberbezpieczeństwo na Politechnice Wrocławskiej. Moja pasja do technologii i bezpieczeństwa napędza mnie do ciągłego poszerzania wiedzy poprzez praktyczne projekty i samodzielną naukę.',
    BACKGROUND_TEXT2:
      'Rozwijam się w wymagających środowiskach, gdzie mogę zastosować zarówno wiedzę teoretyczną, jak i praktyczne umiejętności do rozwiązywania złożonych problemów. Moim celem jest wniesienie wkładu w dziedzinę cyberbezpieczeństwa, jednocześnie stale rozwijając się jako programista.',

    Security: 'Bezpieczeństwo',
    Automation: 'Automatyzacja',
    'Data Science': 'Nauka o danych',
    'Full-Stack Development': 'Programowanie full-stack',

    Security_description:
      '— bycie na bieżąco z najnowszymi zagrożeniami i mechanizmami obronnymi',
    Automation_description:
      '— tworzenie interaktywnych doświadczeń i treści proceduralnych',
    'Data Science_description': '— udział w projektach społecznościowych',
    'Full-Stack Development_description':
      '— badanie testów penetracyjnych i oceny podatności',

    // Projects page
    'PROJECT: SOCIAL IMPACT': '[PROJEKT: WPŁYW SPOŁECZNY]',
    'STATUS: COMPLETED & PUBLISHED': 'STATUS: UKOŃCZONY I OPUBLIKOWANY',
    CONTRIBUTION: 'WKŁAD',
    PLAY_GAME: '[ZAGRAJ]',
    'PROJECT: EDUCATIONAL': '[PROJEKT: EDUKACYJNY]',
    'PROJECT: SOCIAL IMPACT_description': `> Projekt ekologicznej gry komputerowej
              Garbage Can, zorganizowany przez
              fundację Zwolnieni z Teorii`,
    GITHUB_REPOSITORIES: '[REPOZYTORIA_GITHUB]',
    'GITHUB FEED': '▶ KANAŁ GITHUB',
    LOADING: 'ŁADOWANIE',
    PROJECTS: '[PROJEKTY]',
    ACHIEVEMENTS: '[OSIĄGNIĘCIA]',
    'PROJECT_EDUCATIONAL': '[PROJEKT: EDUKACYJNY]',
    'PROJECT_EDUCATIONAL_description': `Wdrożenie indywidualnego planu rozwoju edukacyjnego
          Mazowiecki program stypendialny dla wyjątkowo utalentowanych uczniów
    [ORGANIZATOR: Urząd Marszałkowski Województwa Mazowieckiego]`,

    'PROJECT: EDUCATIONAL_description': `Wdrożenie indywidualnego planu rozwoju edukacyjnego
          Mazowiecki program stypendialny dla wyjątkowo utalentowanych uczniów
    [ORGANIZATOR: Urząd Marszałkowski Województwa Mazowieckiego]`,

    // Contact page
    CONTACT_CHANNELS: '[KANAŁY_KONTAKTU]',
    ENCRYPTED_MAIL: 'SZYFROWANY_MAIL',
    SECURE_MATRIX: 'BEZPIECZNY_MATRIX',
    SOCIAL_NETWORKS: 'SIECI_SPOŁECZNOŚCIOWE',
    DIRECT_TRANSMISSION: '[BEZPOŚREDNIA_TRANSMISJA]',
    IDENTITY_STRING: 'CIĄG_TOŻSAMOŚCI:',
    ENTER_YOUR_NAME: 'WPROWADŹ_SWOJE_IMIĘ',
    CONTACT_NODE: 'WĘZEŁ_KONTAKTOWY:',
    YOUR_ENCRYPTED_MAIL: 'TWÓJ_SZYFROWANY_MAIL',
    TRANSMISSION_TYPE: 'TYP_TRANSMISJI:',
    JOB_OFFER: 'OFERTA_PRACY',
    COLLABORATION: 'WSPÓŁPRACA',
    TECH_QUESTION: 'PYTANIE_TECHNICZNE',
    OTHER_QUERY: 'INNE_ZAPYTANIE',
    'MESSAGE_PAYLOAD:': 'ŁADUNEK_WIADOMOŚCI:',
    ENTER_YOUR_MESSAGE_HERE: 'WPROWADŹ_SWOJĄ_WIADOMOŚĆ_TUTAJ',
    INITIATE_TRANSMISSION: 'INICJUJ_TRANSMISJĘ',
    PURGE_BUFFER: 'WYCZYŚĆ_BUFOR',
    'TRANSMISSION_SUCCESSFUL: Message received and encrypted':
      'TRANSMISJA_UDANA: Wiadomość otrzymana i zaszyfrowana',
    TRANSMISSION_FAILED: 'TRANSMISJA_NIEUDANA',

    // Education details
    'Wroclaw University of Science and Technology': 'Politechnika Wrocławska',
    'INITIALIZED: 2024': 'ROZPOCZĘTE: 2024',
    'FACULTY: Information and Communication Technology':
      'WYDZIAŁ: Informatyka i Telekomunikacja',
    'SPECIALIZATION: Cybersceurity': 'SPECJALIZACJA: Cyberbezpieczeństwo',
    'University of Warsaw': 'Uniwersytet Warszawski',
    'INITIALIZED: 2023 - 2024': 'ROZPOCZĘTE: 2023 - 2024',
    'FACULTY: Mathematics, Informatics and Mechanics':
      'WYDZIAŁ: Matematyka, Informatyka i Mechanika',
    'SPECIALIZATION: Computer Science': 'SPECJALIZACJA: Informatyka',
    LANGUAGES: 'JĘZYKI',
    CERTIFICATES: 'CERTYFIKATY',

    // Footer
    '© 2024 KSZ://CYBER_SITE. All rights reserved.':
      '© 2024 KSZ://CYBER_SITE. Wszelkie prawa zastrzeżone.',
  },
}

// Enhanced Translation Manager similar to Theme Switcher
class TranslationManager {
  constructor() {
    this.currentLang = 'en'
    this.isProcessing = false
    this.failedOnce = false
    this.isInitialized = false
    this.init()
  }

  init() {
    // Prevent multiple initializations
    if (this.isInitialized) {
      return
    }

    try {
      // Check for saved language preference or default to English
      const savedLang = localStorage.getItem('language') || 'en'
      
      // Validate saved language
      const validLang = translations[savedLang] ? savedLang : 'en'
      
      this.setLanguage(validLang)

      // Create translation switcher buttons
      this.createTranslationSwitchers()

      // Listen for browser language changes
      this.listenToBrowserLanguage()
      
      this.isInitialized = true
      console.log('Translation manager initialized with language:', validLang)
    } catch (e) {
      console.error('Failed to initialize translation manager:', e)
      // Fallback initialization
      this.currentLang = 'en'
      this.isInitialized = true
    }
  }

  createTranslationSwitchers() {
    try {
      // Find all buttons that should be translation switchers
      const languageSwitcherButtons = document.querySelectorAll(
        '.language-switcher button'
      )

      let foundSwitcher = false
      
      languageSwitcherButtons.forEach((button, index) => {
        // The first button in language-switcher should be translation switcher
        if (index === 0 || button.id === 'translate-btn') {
          this.setupTranslationButton(button)
          foundSwitcher = true
        }
      })

      // If no translation switcher found, create one
      if (!foundSwitcher) {
        this.createFloatingTranslationSwitcher()
      }
    } catch (e) {
      console.warn('Failed to create translation switchers:', e)
      // Create fallback switcher
      try {
        this.createFloatingTranslationSwitcher()
      } catch (fallbackError) {
        console.error('Failed to create fallback translation switcher:', fallbackError)
      }
    }
  }

  setupTranslationButton(button) {
    button.classList.add('translation-switcher')
    button.setAttribute('aria-label', 'Switch language')
    button.setAttribute('title', 'Switch between Polish and English')

    // Update button text based on current language
    this.updateButtonText(button)

    // Add click event
    button.addEventListener('click', () => {
      this.toggleLanguage()
    })
  }

  updateButtonText(button) {
    if (this.currentLang === 'en') {
      button.innerHTML = '<i class="fas fa-flag"></i> POLSKI'
    } else {
      button.innerHTML = '<i class="fas fa-language"></i> ENGLISH'
    }
  }

  createFloatingTranslationSwitcher() {
    const translationSwitcher = document.createElement('button')
    translationSwitcher.className = 'translation-switcher'
    translationSwitcher.setAttribute('aria-label', 'Switch language')
    translationSwitcher.setAttribute(
      'title',
      'Switch between Polish and English'
    )

    // Set style based on theme
    const setSwitcherStyle = () => {
      const theme = document.documentElement.getAttribute('data-theme') || 'light';
      if (theme === 'light') {
        translationSwitcher.style.cssText = `
          position: fixed;
          bottom: 60px;
          right: 20px;
          z-index: 100;
          background: #fff;
          border: 2px solid #333333;
          color: #333333;
          padding: 10px;
          cursor: pointer;
          box-shadow: 0 0 10px rgba(51,51,51,0.1);
        `;
      } else {
        translationSwitcher.style.cssText = `
          position: fixed;
          bottom: 60px;
          right: 20px;
          z-index: 100;
          background: #000;
          border: 2px solid #00ff00;
          color: #00ff00;
          padding: 10px;
          cursor: pointer;
        `;
      }
    };
    setSwitcherStyle();
    // Listen for theme changes
    document.addEventListener('themeChanged', setSwitcherStyle);

    this.updateButtonText(translationSwitcher)

    // Add to body
    document.body.appendChild(translationSwitcher)

    // Add click event
    translationSwitcher.addEventListener('click', () => {
      this.toggleLanguage()
    })
  }

  toggleLanguage() {
    try {
      if (this.isProcessing) {
        console.log('Language toggle already in progress')
        return
      }
      
      const newLang = this.currentLang === 'en' ? 'pl' : 'en'
      console.log('Toggling language from', this.currentLang, 'to', newLang)
      this.setLanguage(newLang)
    } catch (e) {
      console.error('Failed to toggle language:', e)
    }
  }

  setLanguage(lang) {
    // Prevent recursion and validate language
    if (!lang || !translations[lang]) {
      console.warn('Invalid language:', lang, 'Falling back to English')
      lang = 'en'
    }

    // Prevent infinite recursion by checking if we're already processing
    if (this.isProcessing) {
      console.warn('Language change already in progress')
      return
    }

    this.isProcessing = true

    try {
      this.currentLang = lang

      // Apply language to document
      document.documentElement.lang = lang
      document.body.setAttribute('data-lang', lang)

      // Translate the page
      this.translatePage(lang)

      // Save preference only after successful translation
      localStorage.setItem('language', lang)

      // Update all translation switcher buttons
      const allTranslationButtons = document.querySelectorAll(
        '.translation-switcher'
      )
      allTranslationButtons.forEach((button) => {
        try {
          this.updateButtonText(button)
        } catch (e) {
          console.warn('Failed to update button text:', e)
        }
      })

      // Trigger custom event for other components
      document.dispatchEvent(
        new CustomEvent('languageChanged', {
          detail: { language: lang },
        })
      )
    } catch (e) {
      console.error('Translation error:', e)
      // Only fallback if not already on English and not in recursion
      if (lang !== 'en' && !this.failedOnce) {
        this.failedOnce = true
        localStorage.setItem('language', 'en')
        this.currentLang = 'en'
        this.translatePage('en')
      }
    } finally {
      // Reset processing flag
      this.isProcessing = false
      this.failedOnce = false
    }
  }

  translatePage(lang) {
    // Validate language and translations exist
    if (!lang || !translations[lang]) {
      console.warn('Cannot translate to invalid language:', lang)
      return
    }

    const elements = document.querySelectorAll('[data-translate]')
    let translatedCount = 0
    let failedCount = 0

    elements.forEach((element) => {
      try {
        const key = element.getAttribute('data-translate')
        if (!key) return

        // Check if translation exists
        if (translations[lang][key]) {
          if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.placeholder = translations[lang][key]
          } else {
            element.textContent = translations[lang][key]
          }
          translatedCount++
        } else {
          // Fallback to English if available
          if (lang !== 'en' && translations['en'] && translations['en'][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
              element.placeholder = translations['en'][key]
            } else {
              element.textContent = translations['en'][key]
            }
          }
          console.warn('Missing translation for key:', key, 'in language:', lang)
        }
      } catch (e) {
        failedCount++
        console.warn('Element translation error:', e, 'for element:', element)
      }
    })

    console.log(`Translated ${translatedCount} elements, ${failedCount} failures for language: ${lang}`)

    // Handle special cases for template elements
    this.handleTemplateElements(lang)
  }

  handleTemplateElements(lang) {
  // No longer needed: all translation handled by <span> now
  }

  listenToBrowserLanguage() {
    // Listen for browser language changes
    if (navigator.language) {
      const browserLang = navigator.language.toLowerCase()

      // Only auto-switch if user hasn't manually set a preference
      if (!localStorage.getItem('language')) {
        if (browserLang.startsWith('pl')) {
          this.setLanguage('pl')
        } else {
          this.setLanguage('en')
        }
      }
    }
  }

  // Method to get current language
  getCurrentLanguage() {
    return this.currentLang
  }

  // Method to reset translation system
  reset() {
    console.log('Resetting translation system')
    this.isProcessing = false
    this.failedOnce = false
    this.currentLang = 'en'
    localStorage.setItem('language', 'en')
    
    try {
      this.translatePage('en')
      const allTranslationButtons = document.querySelectorAll('.translation-switcher')
      allTranslationButtons.forEach((button) => {
        try {
          this.updateButtonText(button)
        } catch (e) {
          console.warn('Failed to update button during reset:', e)
        }
      })
    } catch (e) {
      console.error('Failed to reset translation system:', e)
    }
  }
}

// Initialize translation manager when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
  try {
    // Check if already initialized (prevent double initialization)
    if (window.translationManager && window.translationManager.isInitialized) {
      console.log('Translation manager already initialized')
      return
    }
    
    // Initialize translation manager
    window.translationManager = new TranslationManager()
    console.log('Translation manager created successfully')
  } catch (e) {
    console.error('Failed to initialize translation manager:', e)
    
    // Create minimal fallback
    window.translationManager = {
      currentLang: 'en',
      getCurrentLanguage: () => 'en',
      setLanguage: (lang) => {
        console.warn('Translation manager failed, using fallback for:', lang)
        document.documentElement.lang = lang || 'en'
        localStorage.setItem('language', lang || 'en')
      }
    }
  }
})

// Also initialize if DOM is already loaded
if (document.readyState === 'loading') {
  // DOM not yet loaded, wait for DOMContentLoaded
} else {
  // DOM already loaded
  setTimeout(() => {
    if (!window.translationManager) {
      try {
        window.translationManager = new TranslationManager()
      } catch (e) {
        console.error('Failed to initialize translation manager on ready state:', e)
      }
    }
  }, 100)
}

// Export for use in other scripts
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    TranslationManager,
    translations,
  }
}
